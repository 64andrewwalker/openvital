# Jules Integration — OpenVital

> **Project:** [OpenVital](https://github.com/64andrewwalker/openvital) — Health tracking CLI (Rust + SQLite)
> **Based on:** [jules-integration-template.md](./jules-integration-template.md)
> **Scheduled tasks:** [jules-scheduled-tasks.md](./jules-scheduled-tasks.md)

This document defines the project-specific configuration for integrating Jules into the OpenVital development workflow.

---

## 1. Project Context

| Item           | Value                                                            |
| -------------- | ---------------------------------------------------------------- |
| Language       | Rust (2024 edition)                                              |
| Build tool     | Cargo                                                            |
| CI             | GitHub Actions (check, fmt, clippy, test on Linux/macOS/Windows) |
| Test framework | `#[test]` + integration tests in `tests/`                        |
| Main branch    | `main`                                                           |
| Release        | Conventional Commits → release-please                            |
| Architecture   | 4-layer: CLI → Command → Core → DB                               |
| Lint           | `cargo clippy -- -D warnings` (zero warnings policy)             |

### Key Files Jules Should Know

| File                     | Purpose                                    |
| ------------------------ | ------------------------------------------ |
| `CLAUDE.md`              | Project conventions and architecture guide |
| `docs/openvital-spec.md` | Full product specification                 |
| `docs/adr/`              | Architecture Decision Records              |
| `docs/plans/`            | Feature design and implementation plans    |
| `README.md`              | User-facing documentation                  |
| `CHANGELOG.md`           | Auto-generated by release-please           |

---

## 2. Template Variable Bindings

| Template Placeholder | OpenVital Value  |
| -------------------- | ---------------- |
| `{{MAIN_BRANCH}}`    | `main`           |
| `{{OWNER}}`          | `64andrewwalker` |
| `{{REPO}}`           | `openvital`      |

---

## 3. Pipeline Customizations

### Pipeline 1: Doc Sync

OpenVital-specific documentation scope:

```
When analyzing PR diffs, check these OpenVital documentation files:

1. README.md — CLI command table, installation instructions, usage examples
2. docs/openvital-spec.md — product specification, feature descriptions
3. CLAUDE.md — architecture section, CLI commands table, conventions
4. docs/adr/ — if the change introduces a new architectural pattern,
   note that an ADR may be needed (create Issue, don't write it)

OpenVital conventions:
- CLI commands are documented in a table in both README.md and CLAUDE.md
- The architecture section in CLAUDE.md contains the source tree layout
- New commands follow the pattern: cli.rs variant → cmd/ handler → core/ logic
- CHANGELOG is managed by release-please — do NOT modify it manually
- Implemented commands include `anomaly` (IQR-based outlier detection) and `context` (AI health briefing aggregator) — ensure any new command documentation is consistent with these
```

### Pipeline 2: PR Review

OpenVital-specific review criteria:

```
Additional review criteria for this Rust CLI project:

1. Architecture compliance:
   - cmd/ files must NOT contain business logic — only delegation to core/
   - All imports from lib must use `openvital::` prefix, not `crate::`
   - New public functions must use `anyhow::Result<T>`

2. Output contract:
   - Every command must support both JSON (default) and --human modes
   - JSON must follow the envelope: {"status": "ok|error", "command": "...", "data": {...}}

3. Rust-specific:
   - No `#[allow]` attributes unless structurally necessary
   - Use `FromStr` trait for enums parsed from CLI strings
   - Prefer let-chain syntax for collapsible if-let + condition
   - Params structs for functions with >7 arguments

4. Testing:
   - Integration tests in tests/ exercise the full pipeline with temp database
   - Bug fixes should include a regression test
   - Follow BDD+TDD workflow described in CLAUDE.md
```

### Pipeline 3: Issue AutoFix

OpenVital-specific assessment context:

```
OpenVital project context for issue assessment:

- This is a Rust CLI with 4-layer architecture (CLI → Command → Core → DB)
- Build: cargo build / cargo test / cargo clippy -- -D warnings
- The project uses SQLite with a migration system in src/db/migrate.rs
- Metrics are the core data model (health data points with type, value, tags)
- Goals, trends, reports, and status are computed from metrics

You CAN likely fix:
- Clippy warnings or formatting issues
- Simple logic bugs in core/ computation functions
- Missing error handling for specific edge cases
- Test coverage gaps in existing modules

You CANNOT likely fix:
- New CLI commands or subcommands (requires design decisions)
- Database schema changes (requires migration planning)
- Cross-platform issues (needs multi-OS testing)
- Performance issues without clear profiling data
```

---

## 4. Scheduled Tasks Configuration

### Active Agent Pod (Standard tier)

These cron values override the template defaults. The OpenVital workflow file (`jules-scheduled.yml`) must use these schedules, not the template's generic ones.

| Agent             | Frequency    | Cron (UTC)   | OpenVital Notes                         |
| ----------------- | ------------ | ------------ | --------------------------------------- |
| Bug Hunter        | Daily        | `0 2 * * *`  | Focus on `core/` computation logic      |
| Security Patrol   | Daily        | `30 2 * * *` | Check for SQL injection in `db/` layer  |
| Test Coverage     | Weekly (Mon) | `0 3 * * 1`  | Prioritize `core/` modules over `cmd/`  |
| Dependency Health | Weekly (Wed) | `0 3 * * 3`  | `cargo audit` for vulnerability check   |
| Doc Consistency   | Weekly (Fri) | `0 3 * * 5`  | Cross-check README commands vs `cli.rs` |

> **Note:** The template provides Monday-only weekly schedules as defaults. OpenVital spreads weekly tasks across Mon/Wed/Fri to distribute review load. When creating `jules-scheduled.yml`, use the cron values from this table, not the template.

### Deferred Agents

| Agent             | Reason to Defer                              |
| ----------------- | -------------------------------------------- |
| Performance Scout | Not critical for CLI tool at current scale   |
| Dead Code Cleanup | Project is young; minimal dead code expected |

### Prompt Additions for OpenVital

Append to each scheduled task prompt:

```
OpenVital project conventions:
- Build verification: cargo check && cargo fmt --all -- --check && cargo clippy -- -D warnings && cargo test
- All four commands must pass before creating a PR (matches CI pipeline)
- Follow Conventional Commits format: type(scope): description
- Never modify CHANGELOG.md (managed by release-please)
- Integration tests use temp databases — see tests/ for patterns
```

---

## 5. Setup Checklist

- [ ] Connect openvital repo at [jules.google.com](https://jules.google.com)
- [ ] Add `JULES_API_KEY` to GitHub repo secrets
- [x] Create workflow files in `.github/workflows/` based on the template, **with OpenVital cron overrides from Section 4**
  - [x] `jules-events.yml` — event-driven pipelines (doc sync, PR review, issue autofix)
  - [x] `jules-scheduled.yml` — cron-based scheduled tasks (use OpenVital cron table, not template defaults)
- [x] Verify `{{OWNER}}` = `64andrewwalker` in workflow files matches the connected repo
- [x] Create `.github/jules-prompts/` directory with prompt text files per the template's Prompt Management section
- [ ] Test Pipeline 2 (PR Review) first with a test PR
- [ ] Enable remaining pipelines after validating review quality
- [x] Create GitHub label `jules-created` for self-loop prevention (required by issue-autofix filter)
- [x] Create GitHub label `jules-error` for failure tracking

---

## 6. Monitoring

### GitHub Filters

Use these search queries to track Jules activity:

| What                 | GitHub Search                                                               |
| -------------------- | --------------------------------------------------------------------------- |
| All Jules PRs        | `is:pr in:title "[jules-"`                                                  |
| Open Jules PRs       | `is:pr is:open in:title "[jules-"`                                          |
| Jules errors         | `is:issue label:jules-error`                                                |
| Jules-created issues | `is:issue label:jules-created`                                              |
| Bug fixes            | `is:pr in:title "[jules-bug]"`                                              |
| Security findings    | `is:pr in:title "[jules-security]" OR is:issue in:title "[jules-security]"` |

### Weekly Review

Each week, review:

1. How many Jules PRs were merged vs closed without merge
2. False positive rate in PR reviews
3. Any `jules-error` issues to investigate
4. Adjust agent frequencies based on signal-to-noise ratio
